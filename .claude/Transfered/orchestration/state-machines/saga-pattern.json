{
  "name": "Saga Pattern State Machine",
  "description": "State machine for saga-based distributed transactions",
  "initialState": "idle",
  "states": [
    {"name": "idle", "description": "Saga not executing", "type": "initial"},
    {"name": "running", "description": "Saga executing steps", "type": "intermediate"},
    {"name": "executing_step", "description": "Executing current step transaction", "type": "intermediate"},
    {"name": "step_succeeded", "description": "Step completed successfully", "type": "intermediate"},
    {"name": "step_failed", "description": "Step failed", "type": "intermediate"},
    {"name": "attempting_forward_recovery", "description": "Attempting forward recovery", "type": "intermediate"},
    {"name": "compensating", "description": "Executing compensating transactions", "type": "intermediate"},
    {"name": "compensating_step", "description": "Compensating individual step", "type": "intermediate"},
    {"name": "completed", "description": "Saga completed successfully", "type": "final"},
    {"name": "compensated", "description": "Saga compensated after failure", "type": "final"},
    {"name": "failed", "description": "Saga failed", "type": "final"},
    {"name": "cancelled", "description": "Saga cancelled", "type": "final"}
  ],
  "transitions": [
    {"from": "idle", "to": "running", "event": "START_SAGA", "guard": "sagaValid", "action": "initializeExecution"},
    {"from": "running", "to": "executing_step", "event": "NEXT_STEP", "guard": "hasNextStep", "action": "executeTransaction"},
    {"from": "executing_step", "to": "step_succeeded", "event": "STEP_SUCCESS", "guard": null, "action": "recordStepResult"},
    {"from": "step_succeeded", "to": "running", "event": "CONTINUE", "guard": "hasMoreSteps", "action": "moveToNextStep"},
    {"from": "step_succeeded", "to": "completed", "event": "SAGA_COMPLETE", "guard": "!hasMoreSteps", "action": "finalizeSaga"},
    {"from": "executing_step", "to": "step_failed", "event": "STEP_FAILED", "guard": null, "action": "recordFailure"},
    {"from": "step_failed", "to": "attempting_forward_recovery", "event": "TRY_RECOVERY", "guard": "forwardRecoveryEnabled", "action": "attemptRecovery"},
    {"from": "attempting_forward_recovery", "to": "step_succeeded", "event": "RECOVERY_SUCCESS", "guard": null, "action": "recordRecoverySuccess"},
    {"from": "attempting_forward_recovery", "to": "compensating", "event": "RECOVERY_FAILED", "guard": null, "action": "startCompensation"},
    {"from": "step_failed", "to": "compensating", "event": "COMPENSATE", "guard": "!forwardRecoveryEnabled", "action": "startCompensation"},
    {"from": "compensating", "to": "compensating_step", "event": "COMPENSATE_STEP", "guard": "hasStepToCompensate", "action": "executeCompensation"},
    {"from": "compensating_step", "to": "compensating", "event": "COMPENSATION_DONE", "guard": "hasMoreToCompensate", "action": "continueCompensation"},
    {"from": "compensating_step", "to": "compensated", "event": "COMPENSATION_COMPLETE", "guard": "!hasMoreToCompensate", "action": "finalizeCompensation"},
    {"from": "compensating_step", "to": "failed", "event": "COMPENSATION_FAILED", "guard": "criticalStep", "action": "abortSaga"},
    {"from": "running", "to": "cancelled", "event": "CANCEL", "guard": null, "action": "cancelExecution"},
    {"from": "cancelled", "to": "compensating", "event": "COMPENSATE_CANCELLED", "guard": "hasCompletedSteps", "action": "startCompensation"}
  ],
  "errorStates": ["failed", "compensated"],
  "recoveryTransitions": []
}
