graph TB
    subgraph "Event Sources"
        webhook["Webhook Trigger<br/>(External Event)"]
        schedule["Scheduled Event<br/>(Cron/Timer)"]
        manual["Manual Trigger<br/>(User Action)"]
        cascade["Workflow Event<br/>(Cascade)"]
    end

    subgraph "Event Bus"
        bus["Event Hub<br/>---<br/>Distributed Event Stream<br/>Pub/Sub Pattern"]
    end

    subgraph "Event Handlers"
        handler1["Handler: Deploy<br/>---<br/>Listens: deployment.requested<br/>Agent: devops-automator"]
        handler2["Handler: Test<br/>---<br/>Listens: deployment.completed<br/>Agent: test-engineer"]
        handler3["Handler: Notify<br/>---<br/>Listens: test.completed<br/>Agent: notification-service"]
        handler4["Handler: Cleanup<br/>---<br/>Listens: workflow.failed<br/>Agent: cleanup-service"]
    end

    subgraph "Event Store"
        store["Cosmos DB<br/>---<br/>Event Sourcing<br/>Append-Only Log"]
    end

    webhook -->|Publish Event| bus
    schedule -->|Publish Event| bus
    manual -->|Publish Event| bus
    cascade -->|Publish Event| bus

    bus -->|deployment.requested| handler1
    bus -->|deployment.completed| handler2
    bus -->|test.completed| handler3
    bus -->|workflow.failed| handler4

    handler1 -->|Publish| bus
    handler2 -->|Publish| bus
    handler3 -->|Publish| bus
    handler4 -->|Publish| bus

    bus -->|Persist| store

    handler1 -.->|Read History| store
    handler2 -.->|Read History| store
    handler3 -.->|Read History| store
    handler4 -.->|Read History| store

    classDef source fill:#3b82f6,stroke:#2563eb,color:#fff,stroke-width:2px
    classDef bus fill:#8b5cf6,stroke:#7c3aed,color:#fff,stroke-width:2px
    classDef handler fill:#10b981,stroke:#059669,color:#fff,stroke-width:2px
    classDef store fill:#f59e0b,stroke:#d97706,color:#000,stroke-width:2px

    class webhook,schedule,manual,cascade source
    class bus bus
    class handler1,handler2,handler3,handler4 handler
    class store store
