%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#ef4444', 'primaryTextColor':'#fff', 'primaryBorderColor':'#dc2626', 'lineColor':'#5c5c5c', 'secondaryColor':'#0078d4', 'tertiaryColor':'#10b981'}}}%%

graph TB
    subgraph "External Threats"
        internet["Internet<br/>---<br/>Public traffic<br/>Potential threats"]
        attacker["Threat Actors<br/>---<br/>• Script kiddies<br/>• Hacktivists<br/>• Cybercriminals<br/>• Nation states"]
    end

    subgraph "Perimeter Security"
        ddos["Azure DDoS Protection<br/>Standard Tier<br/>---<br/>• L3/L4 protection<br/>• Adaptive tuning<br/>• Attack analytics<br/>• SLA: 99.99%"]
        waf["Web Application Firewall<br/>WAF v2<br/>---<br/>• OWASP Top 10<br/>• Custom rules<br/>• Bot protection<br/>• Geo-filtering"]
        fw["Azure Firewall Premium<br/>---<br/>• TLS inspection<br/>• IDPS<br/>• URL filtering<br/>• Threat intelligence"]
    end

    subgraph "Network Security"
        vnet["Virtual Network<br/>10.0.0.0/16<br/>---<br/>• Network isolation<br/>• Subnet segmentation<br/>• Service endpoints<br/>• Private endpoints"]
        nsg["Network Security Groups<br/>---<br/>• Inbound rules<br/>• Outbound rules<br/>• Application rules<br/>• Priority-based"]
        bastion["Azure Bastion<br/>---<br/>• RDP/SSH proxy<br/>• No public IPs<br/>• MFA required<br/>• Session recording"]
    end

    subgraph "Identity & Access Management"
        aad["Azure AD<br/>---<br/>• SSO<br/>• MFA enforcement<br/>• Conditional access<br/>• Risk-based auth"]
        b2c["Azure AD B2C<br/>---<br/>• Customer identity<br/>• Social providers<br/>• Custom policies<br/>• Password policies"]
        msi["Managed Identities<br/>---<br/>• System-assigned<br/>• User-assigned<br/>• No credentials<br/>• Auto-rotation"]
        rbac["Role-Based Access<br/>---<br/>• Least privilege<br/>• Custom roles<br/>• Just-in-time<br/>• Access reviews"]
    end

    subgraph "Application Security"
        apigw["API Gateway Security<br/>---<br/>• Rate limiting<br/>• API keys<br/>• OAuth 2.0<br/>• JWT validation"]
        cors["CORS Policy<br/>---<br/>• Origin whitelist<br/>• Credentials<br/>• Methods allowed<br/>• Headers control"]
        csp["Content Security Policy<br/>---<br/>• Script sources<br/>• Style sources<br/>• Frame ancestors<br/>• Report URI"]
        headers["Security Headers<br/>---<br/>• X-Frame-Options<br/>• X-Content-Type<br/>• HSTS<br/>• X-XSS-Protection"]
    end

    subgraph "Data Security"
        kv["Azure Key Vault<br/>Premium HSM<br/>---<br/>• Secrets management<br/>• Key rotation<br/>• HSM-backed keys<br/>• Access policies"]
        encrypt["Encryption<br/>---<br/>• TLS 1.3 in-transit<br/>• AES-256 at-rest<br/>• Customer keys (CMK)<br/>• Double encryption"]
        dlp["Data Loss Prevention<br/>---<br/>• Data classification<br/>• Sensitivity labels<br/>• Information barriers<br/>• Purview integration"]
        backup["Backup & Recovery<br/>---<br/>• Automated backups<br/>• Geo-redundancy<br/>• Point-in-time<br/>• Immutable storage"]
    end

    subgraph "Container Security"
        acr["Container Registry<br/>---<br/>• Image scanning<br/>• Vulnerability assess<br/>• Content trust<br/>• Quarantine"]
        aca["Container Apps<br/>---<br/>• Runtime protection<br/>• Network policies<br/>• Secret management<br/>• Admission control"]
        devsec["DevSecOps<br/>---<br/>• SAST scanning<br/>• DAST testing<br/>• Dependency scan<br/>• License compliance"]
    end

    subgraph "Threat Detection & Response"
        defender["Microsoft Defender<br/>---<br/>• Cloud workloads<br/>• Threat detection<br/>• Security score<br/>• Auto-remediation"]
        sentinel["Azure Sentinel<br/>SIEM/SOAR<br/>---<br/>• Log aggregation<br/>• Threat hunting<br/>• Incident response<br/>• Playbooks"]
        monitor["Security Monitoring<br/>---<br/>• Real-time alerts<br/>• Anomaly detection<br/>• Behavioral analysis<br/>• Forensics"]
    end

    subgraph "Compliance & Governance"
        policy["Azure Policy<br/>---<br/>• Compliance rules<br/>• Resource tagging<br/>• Cost control<br/>• Drift prevention"]
        audit["Audit Logging<br/>---<br/>• Activity logs<br/>• Resource logs<br/>• Security logs<br/>• Immutable storage"]
        compliance["Compliance Standards<br/>---<br/>• SOC 2 Type II<br/>• ISO 27001<br/>• GDPR<br/>• HIPAA"]
        blueprint["Azure Blueprints<br/>---<br/>• Environment templates<br/>• Security baseline<br/>• Governance controls<br/>• Version control"]
    end

    subgraph "Security Zones"
        dmz["DMZ Zone<br/>---<br/>Public-facing<br/>WAF protected"]
        app["Application Zone<br/>---<br/>Internal services<br/>Microsegmented"]
        data["Data Zone<br/>---<br/>Restricted access<br/>Encrypted storage"]
        mgmt["Management Zone<br/>---<br/>Admin access<br/>Jump servers"]
    end

    subgraph "Incident Response Plan"
        detect["1. Detection<br/>---<br/>• Alert triggered<br/>• Anomaly found<br/>• User report<br/>Time: < 5 min"]
        triage["2. Triage<br/>---<br/>• Severity assess<br/>• Impact analysis<br/>• Priority assign<br/>Time: < 15 min"]
        contain["3. Containment<br/>---<br/>• Isolate affected<br/>• Stop spread<br/>• Preserve evidence<br/>Time: < 30 min"]
        eradicate["4. Eradication<br/>---<br/>• Remove threat<br/>• Patch vulnerable<br/>• Update rules<br/>Time: < 2 hours"]
        recover["5. Recovery<br/>---<br/>• Restore services<br/>• Verify operation<br/>• Monitor closely<br/>Time: < 4 hours"]
        lessons["6. Lessons Learned<br/>---<br/>• Post-mortem<br/>• Update procedures<br/>• Training needs<br/>Time: < 1 week"]
    end

    internet --> ddos
    attacker -.->|Blocked| ddos
    ddos --> waf
    waf --> fw
    fw --> vnet

    vnet --> nsg
    nsg --> dmz
    bastion --> mgmt

    dmz --> apigw
    apigw --> aad
    aad --> msi
    msi --> rbac

    apigw --> cors
    cors --> csp
    csp --> headers
    headers --> app

    app --> kv
    kv --> encrypt
    encrypt --> data
    data --> dlp
    dlp --> backup

    app --> acr
    acr --> aca
    aca --> devsec

    defender --> monitor
    monitor --> sentinel
    sentinel --> detect

    detect --> triage
    triage --> contain
    contain --> eradicate
    eradicate --> recover
    recover --> lessons

    policy --> audit
    audit --> compliance
    compliance --> blueprint

    data -.->|Logs| audit
    app -.->|Metrics| monitor
    fw -.->|Alerts| sentinel

    classDef threat fill:#fee2e2,stroke:#dc2626,color:#7f1d1d
    classDef perimeter fill:#fce4ec,stroke:#c2185b,color:#880e4f
    classDef network fill:#e3f2fd,stroke:#1976d2,color:#0d47a1
    classDef identity fill:#f3e5f5,stroke:#7b1fa2,color:#4a148c
    classDef app fill:#e8f5e9,stroke:#388e3c,color:#1b5e20
    classDef data fill:#fff3e0,stroke:#f57c00,color:#e65100
    classDef container fill:#e0f2f1,stroke:#00695c,color:#004d40
    classDef monitor fill:#efebe9,stroke:#5d4037,color:#3e2723
    classDef compliance fill:#fafafa,stroke:#424242,color:#212121
    classDef zone fill:#e1f5fe,stroke:#01579b,color:#01579b
    classDef incident fill:#ffebee,stroke:#c62828,color:#b71c1c

    class internet,attacker threat
    class ddos,waf,fw perimeter
    class vnet,nsg,bastion network
    class aad,b2c,msi,rbac identity
    class apigw,cors,csp,headers app
    class kv,encrypt,dlp,backup data
    class acr,aca,devsec container
    class defender,sentinel,monitor monitor
    class policy,audit,compliance,blueprint compliance
    class dmz,app,data,mgmt zone
    class detect,triage,contain,eradicate,recover,lessons incident