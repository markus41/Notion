%% Local Development Deployment Topology
%% Shows how services are deployed for local development
%% Streamlines local development workflow for faster iteration
%% Version: 1.0
%% Last Updated: 2025-10-14

graph TB
    subgraph "Developer Workstation"
        subgraph "Container Runtime (Docker Desktop)"
            subgraph "Frontend Container"
                webapp["React App<br/>---<br/>Port: 5173<br/>Hot Module Reload"]
            end

            subgraph "Backend Containers"
                dotnet_api["Orchestration API<br/>---<br/>Port: 5000<br/>.NET 8 with watch"]
                python_api["Agent Service<br/>---<br/>Port: 8000<br/>FastAPI with reload"]
            end

            subgraph "Infrastructure Containers"
                cosmos_emulator["Cosmos DB Emulator<br/>---<br/>Port: 8081<br/>Local data persistence"]
                redis_local["Redis<br/>---<br/>Port: 6379<br/>Session and cache"]
                azurite["Azurite<br/>---<br/>Port: 10000-10002<br/>Blob/Queue/Table storage"]
            end

            subgraph "Observability Stack"
                jaeger["Jaeger<br/>---<br/>Port: 16686<br/>Distributed tracing UI"]
                grafana["Grafana<br/>---<br/>Port: 3001<br/>Metrics dashboards"]
                prometheus["Prometheus<br/>---<br/>Port: 9090<br/>Metrics collection"]
            end
        end

        subgraph "Development Tools"
            vscode["VS Code<br/>---<br/>IDE with extensions"]
            postman["Postman<br/>---<br/>API testing"]
            browser["Browser DevTools<br/>---<br/>React DevTools"]
        end

        subgraph "Local Services"
            node_modules["Node.js<br/>---<br/>npm/yarn packages"]
            python_venv["Python venv<br/>---<br/>pip packages"]
            dotnet_sdk[".NET SDK<br/>---<br/>NuGet packages"]
        end
    end

    subgraph "External Dependencies"
        npm_registry["npm Registry<br/>---<br/>Package downloads"]
        nuget_registry["NuGet Registry<br/>---<br/>Package downloads"]
        pypi_registry["PyPI Registry<br/>---<br/>Package downloads"]
        docker_hub["Docker Hub<br/>---<br/>Base images"]
    end

    %% Connections
    webapp -->|HTTP| dotnet_api
    webapp -->|WebSocket| dotnet_api
    dotnet_api -->|HTTP| python_api
    python_api -->|SDK| cosmos_emulator
    dotnet_api -->|SDK| cosmos_emulator
    dotnet_api -->|Client| redis_local
    python_api -->|Client| redis_local
    python_api -->|SDK| azurite

    dotnet_api -->|OTLP| jaeger
    python_api -->|OTLP| jaeger
    webapp -->|Metrics| prometheus
    prometheus -->|Query| grafana

    vscode -->|Debug| webapp
    vscode -->|Debug| dotnet_api
    vscode -->|Debug| python_api
    postman -->|Test| dotnet_api
    postman -->|Test| python_api
    browser -->|Inspect| webapp

    node_modules -->|Build| webapp
    python_venv -->|Run| python_api
    dotnet_sdk -->|Run| dotnet_api

    node_modules -.->|Download| npm_registry
    dotnet_sdk -.->|Download| nuget_registry
    python_venv -.->|Download| pypi_registry
    cosmos_emulator -.->|Pull| docker_hub

    %% Apply semantic color coding
    classDef frontend fill:#61dafb,stroke:#4fa8c5,color:#000,stroke-width:2px
    classDef backend fill:#512bd4,stroke:#3a1f9d,color:#fff,stroke-width:2px
    classDef infra fill:#336791,stroke:#254a6b,color:#fff,stroke-width:2px
    classDef observability fill:#f59e0b,stroke:#d97706,color:#000,stroke-width:2px
    classDef tool fill:#10b981,stroke:#059669,color:#fff,stroke-width:2px
    classDef local fill:#8b5cf6,stroke:#7c3aed,color:#fff,stroke-width:2px
    classDef external fill:#94a3b8,stroke:#64748b,color:#fff,stroke-width:2px

    class webapp frontend
    class dotnet_api,python_api backend
    class cosmos_emulator,redis_local,azurite infra
    class jaeger,grafana,prometheus observability
    class vscode,postman,browser tool
    class node_modules,python_venv,dotnet_sdk local
    class npm_registry,nuget_registry,pypi_registry,docker_hub external