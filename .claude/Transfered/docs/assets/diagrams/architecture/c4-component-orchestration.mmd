graph TB
    subgraph "Orchestration API (.NET 8)"
        subgraph "API Controllers"
            wfc["<b>Workflow Controller</b><br/>---<br/>REST endpoints for<br/>workflow management"]
            tc["<b>Task Controller</b><br/>---<br/>Task execution<br/>and monitoring"]
            ac["<b>Agent Controller</b><br/>---<br/>Agent registration<br/>and configuration"]
        end

        subgraph "Core Orchestration"
            orch["<b>MetaAgent Orchestrator</b><br/>---<br/>DAG dependency resolution<br/>Task scheduling<br/>Quality gate enforcement"]
            exec["<b>Task Executor</b><br/>---<br/>Agent invocation<br/>Timeout management<br/>Retry logic"]
            coord["<b>Agent Coordinator</b><br/>---<br/>Multi-agent communication<br/>Event pub/sub<br/>State synchronization"]
        end

        subgraph "State Management"
            cp["<b>Checkpoint Manager</b><br/>---<br/>State snapshots<br/>Versioning<br/>Recovery"]
            es["<b>Event Sourcing</b><br/>---<br/>Event stream<br/>Replay capability<br/>Audit trail"]
            sm["<b>State Machine</b><br/>---<br/>Workflow transitions<br/>Status tracking<br/>Compensation"]
        end

        subgraph "Quality & Monitoring"
            qg["<b>Quality Gate Enforcer</b><br/>---<br/>Pre/post task checks<br/>Blocking/warning rules<br/>Validation"]
            mon["<b>Metrics Collector</b><br/>---<br/>Performance metrics<br/>Success/failure rates<br/>SLA tracking"]
        end

        subgraph "Resilience"
            cb["<b>Circuit Breaker</b><br/>---<br/>Failure detection<br/>Auto-recovery<br/>Fallback logic"]
            rl["<b>Rate Limiter</b><br/>---<br/>Token bucket<br/>Backpressure<br/>Throttling"]
        end
    end

    wfc -->|Create workflow| orch
    tc -->|Execute task| exec
    ac -->|Register agent| coord

    orch -->|Schedule| exec
    orch -->|Enforce| qg
    orch -->|Dependencies| sm

    exec -->|Invoke| coord
    exec -->|Create| cp
    exec -->|Publish| es
    exec -->|Protect| cb
    exec -->|Throttle| rl

    coord -->|Update| sm
    coord -->|Track| mon

    cp -->|Load| sm
    es -->|Replay| sm

    qg -->|Validate| sm
    qg -->|Report| mon

    cb -->|Report| mon
    rl -->|Report| mon

    classDef controller fill:#3b82f6,stroke:#2563eb,color:#fff,stroke-width:2px
    classDef core fill:#8b5cf6,stroke:#7c3aed,color:#fff,stroke-width:2px
    classDef state fill:#10b981,stroke:#059669,color:#fff,stroke-width:2px
    classDef quality fill:#f59e0b,stroke:#d97706,color:#000,stroke-width:2px
    classDef resilience fill:#ef4444,stroke:#dc2626,color:#fff,stroke-width:2px

    class wfc,tc,ac controller
    class orch,exec,coord core
    class cp,es,sm state
    class qg,mon quality
    class cb,rl resilience
