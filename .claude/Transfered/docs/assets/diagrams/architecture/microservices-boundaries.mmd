%% Microservices Boundaries and Dependencies
%% Shows service boundaries, domain contexts, and dependencies
%% Establishes clear service ownership for scalable team operations
%% Version: 1.0
%% Last Updated: 2025-10-14

graph TB
    subgraph "Frontend Boundary"
        subgraph "Presentation Services"
            web_app["Web Application<br/>---<br/>Owner: Frontend Team<br/>React, TypeScript"]
            mobile_app["Mobile Apps<br/>---<br/>Owner: Mobile Team<br/>React Native"]
            admin_portal["Admin Portal<br/>---<br/>Owner: Platform Team<br/>Internal tools"]
        end

        subgraph "API Gateway"
            bff_web["BFF Web<br/>---<br/>Web-specific API<br/>GraphQL"]
            bff_mobile["BFF Mobile<br/>---<br/>Mobile-optimized<br/>REST"]
            bff_admin["BFF Admin<br/>---<br/>Admin operations<br/>gRPC"]
        end
    end

    subgraph "Core Domain Boundary"
        subgraph "Workflow Context"
            workflow_service["Workflow Service<br/>---<br/>Owner: Workflow Team<br/>Bounded Context: Workflow"]
            orchestration_service["Orchestration Service<br/>---<br/>Owner: Platform Team<br/>Task coordination"]
            state_service["State Service<br/>---<br/>Owner: Platform Team<br/>State management"]
        end

        subgraph "Agent Context"
            agent_service["Agent Service<br/>---<br/>Owner: AI Team<br/>Bounded Context: Agents"]
            llm_gateway["LLM Gateway<br/>---<br/>Owner: AI Team<br/>AI provider abstraction"]
            prompt_service["Prompt Service<br/>---<br/>Owner: AI Team<br/>Prompt management"]
        end

        subgraph "Execution Context"
            execution_service["Execution Service<br/>---<br/>Owner: Runtime Team<br/>Task execution"]
            checkpoint_service["Checkpoint Service<br/>---<br/>Owner: Runtime Team<br/>Recovery points"]
            scheduler_service["Scheduler Service<br/>---<br/>Owner: Runtime Team<br/>Job scheduling"]
        end
    end

    subgraph "Supporting Domain Boundary"
        subgraph "User Context"
            user_service["User Service<br/>---<br/>Owner: Identity Team<br/>User management"]
            auth_service["Auth Service<br/>---<br/>Owner: Security Team<br/>Authentication"]
            permission_service["Permission Service<br/>---<br/>Owner: Security Team<br/>Authorization"]
        end

        subgraph "Analytics Context"
            analytics_service["Analytics Service<br/>---<br/>Owner: Data Team<br/>Metrics & insights"]
            reporting_service["Reporting Service<br/>---<br/>Owner: Data Team<br/>Report generation"]
            telemetry_service["Telemetry Service<br/>---<br/>Owner: Platform Team<br/>System telemetry"]
        end

        subgraph "Integration Context"
            notification_service["Notification Service<br/>---<br/>Owner: Platform Team<br/>Multi-channel alerts"]
            webhook_service["Webhook Service<br/>---<br/>Owner: Integration Team<br/>External events"]
            file_service["File Service<br/>---<br/>Owner: Platform Team<br/>File management"]
        end
    end

    subgraph "Infrastructure Boundary"
        subgraph "Data Services"
            database_proxy["Database Proxy<br/>---<br/>Owner: Data Team<br/>Connection pooling"]
            cache_service["Cache Service<br/>---<br/>Owner: Platform Team<br/>Distributed cache"]
            search_service["Search Service<br/>---<br/>Owner: Data Team<br/>Full-text search"]
        end

        subgraph "Messaging Services"
            event_bus["Event Bus<br/>---<br/>Owner: Platform Team<br/>Event distribution"]
            message_queue["Message Queue<br/>---<br/>Owner: Platform Team<br/>Async processing"]
            stream_processor["Stream Processor<br/>---<br/>Owner: Data Team<br/>Real-time processing"]
        end

        subgraph "Platform Services"
            config_service["Config Service<br/>---<br/>Owner: Platform Team<br/>Configuration mgmt"]
            secret_service["Secret Service<br/>---<br/>Owner: Security Team<br/>Secrets management"]
            discovery_service["Discovery Service<br/>---<br/>Owner: Platform Team<br/>Service registry"]
        end
    end

    %% Frontend dependencies
    web_app --> bff_web
    mobile_app --> bff_mobile
    admin_portal --> bff_admin

    %% BFF to core services
    bff_web --> workflow_service
    bff_web --> agent_service
    bff_mobile --> user_service
    bff_admin --> analytics_service

    %% Core service dependencies
    workflow_service --> orchestration_service
    workflow_service --> state_service
    orchestration_service --> agent_service
    orchestration_service --> execution_service

    agent_service --> llm_gateway
    agent_service --> prompt_service
    execution_service --> checkpoint_service
    execution_service --> scheduler_service

    %% Supporting service dependencies
    workflow_service --> user_service
    agent_service --> auth_service
    execution_service --> permission_service

    orchestration_service --> analytics_service
    state_service --> reporting_service
    checkpoint_service --> telemetry_service

    workflow_service --> notification_service
    agent_service --> webhook_service
    execution_service --> file_service

    %% Infrastructure dependencies
    state_service --> database_proxy
    agent_service --> cache_service
    prompt_service --> search_service

    orchestration_service --> event_bus
    execution_service --> message_queue
    analytics_service --> stream_processor

    All_services -.->|Config| config_service
    All_services -.->|Secrets| secret_service
    All_services -.->|Discovery| discovery_service

    %% Cross-boundary event flows
    workflow_service -.->|Events| event_bus
    agent_service -.->|Events| event_bus
    execution_service -.->|Events| event_bus
    event_bus -.->|Subscribe| analytics_service
    event_bus -.->|Subscribe| notification_service

    %% Apply semantic color coding
    classDef frontend fill:#61dafb,stroke:#4fa8c5,color:#000,stroke-width:2px
    classDef core fill:#3eaf7c,stroke:#2d8659,color:#fff,stroke-width:3px
    classDef supporting fill:#8b5cf6,stroke:#7c3aed,color:#fff,stroke-width:2px
    classDef infrastructure fill:#f59e0b,stroke:#d97706,color:#000,stroke-width:2px
    classDef boundary stroke:#ef4444,stroke-width:4px,fill:none,stroke-dasharray: 10 5

    class web_app,mobile_app,admin_portal,bff_web,bff_mobile,bff_admin frontend
    class workflow_service,orchestration_service,state_service,agent_service,llm_gateway,prompt_service,execution_service,checkpoint_service,scheduler_service core
    class user_service,auth_service,permission_service,analytics_service,reporting_service,telemetry_service,notification_service,webhook_service,file_service supporting
    class database_proxy,cache_service,search_service,event_bus,message_queue,stream_processor,config_service,secret_service,discovery_service infrastructure