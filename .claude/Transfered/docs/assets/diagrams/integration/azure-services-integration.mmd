graph TB
    subgraph "Agent Studio Platform"
        App["Application Layer<br/>---<br/>.NET + Python + React"]
    end

    subgraph "Identity & Access Management"
        AAD["Azure AD<br/>---<br/>OAuth 2.0 + OIDC<br/>User authentication<br/>Service principals"]
        RBAC["RBAC<br/>---<br/>Role assignments<br/>Custom roles<br/>Conditional access"]
    end

    subgraph "Compute Services"
        ContainerApps["Container Apps<br/>---<br/>API + Agent runtimes<br/>Auto-scaling<br/>Zero-downtime deployment"]
        Functions["Azure Functions<br/>---<br/>Event-driven tasks<br/>Scheduled jobs<br/>Webhook handlers"]
    end

    subgraph "Data Services"
        Cosmos["Cosmos DB<br/>---<br/>Workflow state<br/>Checkpoints<br/>Event log<br/>99.999% SLA"]
        Redis["Azure Cache for Redis<br/>---<br/>Session state<br/>Distributed cache<br/>Rate limiting<br/>Pub/Sub"]
        Storage["Blob Storage<br/>---<br/>Artifacts<br/>Logs<br/>Backups<br/>Hot/Cool tiers"]
        Search["AI Search<br/>---<br/>Vector search<br/>Full-text search<br/>Semantic ranking"]
    end

    subgraph "AI Services"
        OpenAI["Azure OpenAI<br/>---<br/>GPT-4<br/>Claude<br/>Embeddings<br/>Fine-tuned models"]
        CogServices["Cognitive Services<br/>---<br/>Speech<br/>Vision<br/>Language"]
    end

    subgraph "Integration Services"
        ServiceBus["Service Bus<br/>---<br/>Async messaging<br/>Dead-letter queues<br/>Sessions"]
        EventHub["Event Hub<br/>---<br/>Event streaming<br/>Kafka-compatible<br/>Change feed"]
        EventGrid["Event Grid<br/>---<br/>Event routing<br/>Webhooks<br/>Pub/Sub"]
        SignalR["SignalR Service<br/>---<br/>Real-time updates<br/>WebSockets<br/>Server broadcast"]
    end

    subgraph "DevOps Services"
        ACR["Container Registry<br/>---<br/>Container images<br/>Vulnerability scanning<br/>Geo-replication"]
        Pipelines["Azure Pipelines<br/>---<br/>CI/CD<br/>YAML pipelines<br/>Release gates"]
        Monitor["Azure Monitor<br/>---<br/>Metrics<br/>Logs<br/>Alerts<br/>Workbooks"]
        Insights["Application Insights<br/>---<br/>APM<br/>Distributed tracing<br/>Live metrics"]
    end

    subgraph "Security Services"
        KeyVault["Key Vault<br/>---<br/>Secrets<br/>Certificates<br/>Keys<br/>Managed Identity"]
        Defender["Defender for Cloud<br/>---<br/>Security posture<br/>Threat protection<br/>Compliance"]
        Sentinel["Azure Sentinel<br/>---<br/>SIEM<br/>Threat detection<br/>Incident response"]
    end

    subgraph "Networking"
        VNet["Virtual Network<br/>---<br/>Network isolation<br/>Private endpoints<br/>NSGs"]
        AppGateway["Application Gateway<br/>---<br/>WAF<br/>SSL offload<br/>Load balancing"]
        FrontDoor["Front Door<br/>---<br/>CDN<br/>Global routing<br/>DDoS protection"]
    end

    %% Identity & Access
    App -->|Authenticate| AAD
    AAD -->|Authorize| RBAC
    App -->|Managed Identity| KeyVault

    %% Compute
    App -->|Deployed to| ContainerApps
    App -->|Triggers| Functions
    ContainerApps -->|Pull images| ACR

    %% Data
    App -->|Read/Write| Cosmos
    App -->|Cache| Redis
    App -->|Store files| Storage
    App -->|Vector search| Search

    %% AI
    App -->|Inference| OpenAI
    App -->|Vision/Speech| CogServices

    %% Integration
    App -->|Async messages| ServiceBus
    App -->|Event stream| EventHub
    App -->|Events| EventGrid
    App -->|Real-time| SignalR

    %% Security
    App -->|Get secrets| KeyVault
    Defender -->|Protect| App
    Sentinel -->|Monitor| App

    %% Monitoring
    App -->|Telemetry| Insights
    Insights -->|Aggregate| Monitor
    Monitor -->|Alert| EventGrid

    %% DevOps
    Pipelines -->|Deploy| ContainerApps
    Pipelines -->|Push images| ACR

    %% Networking
    App -->|Private network| VNet
    FrontDoor -->|Route traffic| AppGateway
    AppGateway -->|WAF protection| ContainerApps

    %% Change Feed Integration
    Cosmos -.->|Change feed| EventHub
    EventHub -->|Process| Functions
    Functions -->|Update| Search

    classDef app fill:#3eaf7c,stroke:#2d8659,color:#fff,stroke-width:3px
    classDef identity fill:#0078d4,stroke:#005a9e,color:#fff,stroke-width:2px
    classDef compute fill:#512bd4,stroke:#3a1f9d,color:#fff,stroke-width:2px
    classDef data fill:#336791,stroke:#254a6b,color:#fff,stroke-width:2px
    classDef ai fill:#ec4899,stroke:#db2777,color:#fff,stroke-width:2px
    classDef integration fill:#f59e0b,stroke:#d97706,color:#000,stroke-width:2px
    classDef devops fill:#10b981,stroke:#059669,color:#fff,stroke-width:2px
    classDef security fill:#ef4444,stroke:#dc2626,color:#fff,stroke-width:2px
    classDef network fill:#8b5cf6,stroke:#7c3aed,color:#fff,stroke-width:2px

    class App app
    class AAD,RBAC identity
    class ContainerApps,Functions compute
    class Cosmos,Redis,Storage,Search data
    class OpenAI,CogServices ai
    class ServiceBus,EventHub,EventGrid,SignalR integration
    class ACR,Pipelines,Monitor,Insights devops
    class KeyVault,Defender,Sentinel security
    class VNet,AppGateway,FrontDoor network
